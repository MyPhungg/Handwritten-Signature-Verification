<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thêm Khách Hàng</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/themKH.css') }}"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-center text-primary">Thêm Khách Hàng Mới</h2>

      <!-- Thông báo -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="alert alert-dismissible fade show" role="alert">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <form action="{{ url_for('home.them_khachhang') }}" method="POST" novalidate>
        <div class="mb-3">
          <label class="form-label">Họ và Tên:</label>
          <input
            type="text"
            name="HoTen"
            class="form-control"
            pattern="^[A-Za-zÀ-ỹ ]+$"
            title="Chỉ chứa chữ cái và dấu cách"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Ngày Sinh:</label>
          <input
            type="date"
            name="NgaySinh"
            class="form-control"
            required
          />
          <div class="invalid-feedback">
            Bạn phải đủ 18 tuổi để làm thẻ ngân hàng.
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Số CCCD:</label>
          <input
            type="text"
            name="SoCCCD"
            class="form-control"
            pattern="^\d{12}$"
            title="Phải có đúng 12 chữ số"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Ngày Cấp CCCD:</label>
          <input
            type="date"
            name="NgayCapCCCD"
            class="form-control"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Nơi Cấp CCCD:</label>
          <input
            type="text"
            name="NoiCapCCCD"
            class="form-control"
            pattern="^[A-Za-zÀ-ỹ ]+$"
            title="Chỉ chứa chữ cái và dấu cách"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Có Giá Trị Đến:</label>
          <input
            type="date"
            name="CoGiaTriDen"
            class="form-control"
            required
          />
          <div class="invalid-feedback">
            CCCD đã hết hiệu lực.
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Quốc Tịch:</label>
          <input
            type="text"
            name="QuocTich"
            class="form-control"
            pattern="^[A-Za-zÀ-ỹ ]+$"
            title="Chỉ chứa chữ cái và dấu cách"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Dân Tộc:</label>
          <input
            type="text"
            name="DanToc"
            class="form-control"
            pattern="^[A-Za-zÀ-ỹ ]+$"
            title="Chỉ chứa chữ cái và dấu cách"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Nơi Cư Trú:</label>
          <input
            type="text"
            name="NoiCuTru"
            class="form-control"
            pattern="^[A-Za-z0-9À-ỹ ,./-]+$"
            title="Chỉ chứa chữ cái, số, dấu cách và ký tự , . / -"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Địa Chỉ Hiện Tại:</label>
          <input
            type="text"
            name="DiaChiHienTai"
            class="form-control"
            pattern="^[A-Za-z0-9À-ỹ ,./-]+$"
            title="Chỉ chứa chữ cái, số, dấu cách và ký tự , . / -"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Địa Chỉ Thường Trú:</label>
          <input
            type="text"
            name="DiaChiThuongTru"
            class="form-control"
            pattern="^[A-Za-z0-9À-ỹ ,./-]+$"
            title="Chỉ chứa chữ cái, số, dấu cách và ký tự , . / -"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Giới Tính:</label>
          <select name="GioiTinh" class="form-control" required>
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Số Điện Thoại:</label>
          <input
            type="text"
            name="SoDienThoai"
            class="form-control"
            pattern="^0\d{9}$"
            title="Phải có 10 chữ số và bắt đầu bằng 0"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Nghề Nghiệp:</label>
          <input
            type="text"
            name="NgheNghiep"
            class="form-control"
            pattern="^[A-Za-zÀ-ỹ ]+$"
            title="Chỉ chứa chữ cái và dấu cách"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Email:</label>
          <input
            type="email"
            name="Email"
            class="form-control"
            title="Email không hợp lệ"
            required
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Chữ Ký:</label>
          <input
            type="file"
            name="ChuKy"
            id="chuKyInput"
            class="form-control"
            accept="image/*"
            required
          />
          <img id="preview" style="display:none; max-width:100%; margin-top:10px;" />
        </div>

        <button type="submit" class="btn btn-success w-100">Thêm Khách Hàng</button>
        <a href="{{ url_for('home.admin_khachhang') }}" class="btn btn-secondary w-100 mt-2">Quay Lại</a>
      </form>
    </div>
    <script>
      // Thiết lập ngày
      document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth()+1).padStart(2,'0');
        const dd = String(today.getDate()).padStart(2,'0');
        const strToday = `${yyyy}-${mm}-${dd}`;

        // Ngày sinh tối đa (>=18 tuổi)
        const dobInput = document.querySelector('input[name="NgaySinh"]');
        const eighteen = new Date(yyyy - 18, today.getMonth(), today.getDate());
        dobInput.max = `${eighteen.getFullYear()}-${String(eighteen.getMonth()+1).padStart(2,'0')}-${String(eighteen.getDate()).padStart(2,'0')}`;

        // CCCD issue date <= today
        const issueInput = document.querySelector('input[name="NgayCapCCCD"]');
        issueInput.max = strToday;

        // CCCD valid until >= today
        const validInput = document.querySelector('input[name="CoGiaTriDen"]');
        validInput.min = strToday;
      });

      // Preview chữ ký
      document.getElementById('chuKyInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('preview');
        if (file) {
          preview.src = URL.createObjectURL(file);
          preview.style.display = 'block';
        } else {
          preview.style.display = 'none';
        }
      });

      // Bootstrap form validation
      (function () {
        'use strict'
        const forms = document.querySelectorAll('form');
        Array.from(forms).forEach(form => {
          form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      })();
    </script>
  </body>
</html>
